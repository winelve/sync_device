# æ–‡ä»¶å‘½åå’Œè·¯å¾„ç®¡ç†ç³»ç»Ÿ

## æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†ç»Ÿä¸€çš„æ–‡ä»¶å‘½åå’Œè·¯å¾„ç®¡ç†ï¼Œè§£å†³äº†ä¹‹å‰ä»£ç ä¸­æ–‡ä»¶å‘½åæ··ä¹±å’Œè·¯å¾„ç®¡ç†åˆ†æ•£çš„é—®é¢˜ã€‚æ–°ç³»ç»Ÿé‡‡ç”¨å·¥ç¨‹åŒ–çš„è®¾è®¡æ€è·¯ï¼Œæä¾›äº†æ¸…æ™°çš„ç›®å½•ç»“æ„å’Œæœ‰æ„ä¹‰çš„æ–‡ä»¶å‘½åã€‚

## ä¸»è¦ç‰¹æ€§

### ğŸ—ï¸ ç»Ÿä¸€çš„ç›®å½•ç»“æ„
```
recordings/
â”œâ”€â”€ sync/              # åŒæ­¥æ¨¡å¼å½•åˆ¶
â”‚   â””â”€â”€ æ—¶é—´æˆ³/
â”‚       â”œâ”€â”€ æ—¶é—´æˆ³-master-è®¾å¤‡å.mkv
â”‚       â”œâ”€â”€ æ—¶é—´æˆ³-sub-è®¾å¤‡å.mkv
â”‚       â”œâ”€â”€ æ—¶é—´æˆ³-éŸ³é¢‘è®¾å¤‡å.wav
â”‚       â””â”€â”€ session_info.json
â””â”€â”€ standalone/        # ç‹¬ç«‹æ¨¡å¼å½•åˆ¶
    â””â”€â”€ æ—¶é—´æˆ³/
        â”œâ”€â”€ æ—¶é—´æˆ³-standalone-è®¾å¤‡å.mkv
        â”œâ”€â”€ æ—¶é—´æˆ³-éŸ³é¢‘è®¾å¤‡å.wav
        â””â”€â”€ session_info.json
```

### ğŸ“ æœ‰æ„ä¹‰çš„æ–‡ä»¶å‘½å
- **æ—§ç³»ç»Ÿ**: `master-2025-08-14_15-30-45-device0.mkv`
- **æ–°ç³»ç»Ÿ**: `2025-08-14_15-30-45-master-master_cam.mkv`

### ğŸ”§ çµæ´»çš„è®¾å¤‡å‘½åé…ç½®
```json
{
  "kinect": {
    "device_names": {
      "127.0.0.1": {
        "0": "master_cam",
        "2": "left_cam",
        "3": "right_cam"
      },
      "local": {
        "1": "standalone_cam"
      }
    }
  },
  "audio": {
    "device_names": {
      "1": "main_mic",
      "5": "backup_mic",
      "6": "wireless_mic"
    }
  }
}
```

### ğŸ“Š è‡ªåŠ¨ç”Ÿæˆä¼šè¯ä¿¡æ¯
æ¯æ¬¡å½•åˆ¶ä¼šè‡ªåŠ¨ç”Ÿæˆ `session_info.json`ï¼ŒåŒ…å«ï¼š
- å½•åˆ¶æ—¶é—´å’Œé…ç½®
- å‚ä¸å½•åˆ¶çš„è®¾å¤‡ä¿¡æ¯
- ç”Ÿæˆçš„æ–‡ä»¶åˆ—è¡¨
- ä¼šè¯å…ƒæ•°æ®

## æ ¸å¿ƒç»„ä»¶

### 1. ConfigManager (src/config.py)
- **åŠŸèƒ½**: ç»Ÿä¸€é…ç½®ç®¡ç†
- **æ–°å¢æ–¹æ³•**:
  - `create_session_directory()`: åˆ›å»ºå½•åˆ¶ä¼šè¯ç›®å½•
  - `get_device_name()`: è·å–è®¾å¤‡å‹å¥½åç§°
  - `create_session_info()`: ç”Ÿæˆä¼šè¯ä¿¡æ¯æ–‡ä»¶

### 2. NamingManager (src/naming.py)
- **åŠŸèƒ½**: æ–‡ä»¶å‘½åå’Œè·¯å¾„ç®¡ç†
- **æ ¸å¿ƒæ–¹æ³•**:
  - `create_recording_session()`: åˆ›å»ºå½•åˆ¶ä¼šè¯
  - `generate_kinect_filename()`: ç”ŸæˆKinectæ–‡ä»¶å
  - `generate_audio_filename()`: ç”ŸæˆéŸ³é¢‘æ–‡ä»¶å
  - `finalize_session()`: å®Œæˆä¼šè¯å¹¶ä¿å­˜ä¿¡æ¯

### 3. æ›´æ–°çš„ä¸»è¦æ–‡ä»¶
- **main.py**: é›†æˆå‘½åç®¡ç†å™¨
- **kinect_record_master.py**: æ”¯æŒæ–°çš„å‘½åç³»ç»Ÿ
- **audiorec.py**: æ”¯æŒè®¾å¤‡å‹å¥½å‘½å

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨
```python
from src.utils.config import get_config_manager
from src.main import DeviceCtlSys

# åˆå§‹åŒ–é…ç½®
config_manager = get_config_manager("./config.json")

# åˆ›å»ºæ§åˆ¶ç³»ç»Ÿ
controller = DeviceCtlSys(config_manager)

# å¼€å§‹å½•åˆ¶ï¼ˆè‡ªåŠ¨åˆ›å»ºç›®å½•å’Œå‘½åæ–‡ä»¶ï¼‰
controller.start_recording()
```

### è‡ªå®šä¹‰è®¾å¤‡å‘½å
```python
# æ›´æ–°è®¾å¤‡å‘½å
config_manager.update_config("kinect", {
    "device_names": {
        "192.168.1.100": {
            "0": "front_camera",
            "1": "back_camera"
        }
    }
})
```

### ä¿®æ”¹è¾“å‡ºè·¯å¾„
```python
# è‡ªå®šä¹‰å½•åˆ¶æ ¹ç›®å½•
config_manager.update_config("recording", {
    "base_output_dir": "custom_recordings"
})
```

## é…ç½®è¯´æ˜

### å½•åˆ¶é…ç½®æ–°å¢é¡¹
- `base_output_dir`: å½•åˆ¶æ–‡ä»¶æ ¹ç›®å½•ï¼ˆé»˜è®¤ï¼š"recordings"ï¼‰
- `timestamp_format`: æ—¶é—´æˆ³æ ¼å¼ï¼ˆé»˜è®¤ï¼š"%Y-%m-%d_%H-%M-%S"ï¼‰

### è®¾å¤‡å‘½åé…ç½®
- **Kinectè®¾å¤‡**: `kinect.device_names`
- **éŸ³é¢‘è®¾å¤‡**: `audio.device_names`

## æµ‹è¯•å’Œæ¼”ç¤º

### è¿è¡Œæµ‹è¯•
```bash
# æµ‹è¯•å‘½åç³»ç»Ÿ
python test_naming.py

# æŸ¥çœ‹é…ç½®ä¿¡æ¯
python demo.py config

# æµ‹è¯•å½•åˆ¶æ¨¡å¼ï¼ˆéœ€è¦è®¾å¤‡ï¼‰
python demo.py standalone
python demo.py sync
```

### æµ‹è¯•ç»“æœç¤ºä¾‹
```
å½•åˆ¶ä¼šè¯: recordings/sync/2025-08-14_15-30-45/
â”œâ”€â”€ 2025-08-14_15-30-45-master-master_cam.mkv
â”œâ”€â”€ 2025-08-14_15-30-45-sub-left_cam.mkv
â”œâ”€â”€ 2025-08-14_15-30-45-sub-right_cam.mkv
â”œâ”€â”€ 2025-08-14_15-30-45-main_mic.wav
â””â”€â”€ session_info.json
```

## ä¼˜åŠ¿å¯¹æ¯”

### æ—§ç³»ç»Ÿé—®é¢˜
- âŒ æ–‡ä»¶å‘½åæ··ä¹± (`master-æ—¶é—´æˆ³-device0.mkv`)
- âŒ è·¯å¾„ç®¡ç†åˆ†æ•£åœ¨å„ä¸ªæ¨¡å—
- âŒ ç¡¬ç¼–ç çš„ç›®å½•ç»“æ„
- âŒ ç¼ºå°‘å½•åˆ¶ä¼šè¯ä¿¡æ¯

### æ–°ç³»ç»Ÿä¼˜åŠ¿
- âœ… ç»Ÿä¸€çš„æ–‡ä»¶å‘½åè§„åˆ™
- âœ… é›†ä¸­çš„è·¯å¾„ç®¡ç†
- âœ… å¯é…ç½®çš„è®¾å¤‡å‘½å
- âœ… è‡ªåŠ¨çš„ä¼šè¯ç®¡ç†
- âœ… å®Œæ•´çš„å½•åˆ¶å…ƒæ•°æ®
- âœ… å·¥ç¨‹åŒ–çš„ä»£ç ç»“æ„

## å‘åå…¼å®¹æ€§

æ–°ç³»ç»Ÿä¿æŒäº†ä¸ç°æœ‰ä»£ç çš„å…¼å®¹æ€§ï¼š
- æ‰€æœ‰åŸæœ‰çš„é…ç½®å‚æ•°ä»ç„¶æœ‰æ•ˆ
- ä¿ç•™äº†æ—§çš„å‘½åæ–¹å¼ä½œä¸ºåå¤‡æ–¹æ¡ˆ
- ç°æœ‰çš„å½•åˆ¶æµç¨‹æ— éœ€ä¿®æ”¹

## æ–‡æ¡£

- **CONFIG.md**: è¯¦ç»†çš„é…ç½®æ–‡ä»¶è¯´æ˜
- **demo.py**: ä½¿ç”¨ç¤ºä¾‹å’Œæ¼”ç¤º
- **test_naming.py**: åŠŸèƒ½æµ‹è¯•è„šæœ¬

è¿™ä¸ªæ–°çš„å‘½åç³»ç»Ÿæä¾›äº†æ›´å¥½çš„æ–‡ä»¶ç»„ç»‡ã€æ›´æ¸…æ™°çš„å‘½åè§„åˆ™å’Œæ›´å¼ºçš„å¯é…ç½®æ€§ï¼ŒåŒæ—¶ä¿æŒäº†ä»£ç çš„æ•´æ´å’Œå¯ç»´æŠ¤æ€§ã€‚
